#!/bin/bash

# This script is made to automatize in a parallelized way the creation of 1D vector png images from apks
# It launches the Python script made available in DexRay's paper
# You should run it from the /pre_processing folder

dataset_dir="../_dataset"
destination_dir="../_original_dexray_img"

# Make the variable accessible to the subprocesses (in process_apk function)
export dataset_dir
export destination_dir

process_apk() {
    apk=$1 # path to apk
    type=$(echo "$apk" | grep -oE "(Malware|Goodware)") # extract word Malware or Goodware from path
    destination_folder="$destination_dir/$type" # Determine dest folder according to type
    mkdir -p "$destination_folder"
    python apktoimg_dexray.py "$apk" "$destination_folder" # Execute Python script from DexRay's paper
}

# Make the function accessible to the subprocesses
export -f process_apk

# Find all the apks and send them to 'parallel', which executes the function process_apk on each file in parallel
# option --bar to display the progress
find "$dataset_dir" -name '*.apk' | parallel --bar process_apk
