import argparse
import glob
import os
import shutil

from tqdm import tqdm

DEFAULT_UNSORTED_DATASET_FOLDER = "unsorted_dataset"


def parse_args():
    parser = argparse.ArgumentParser(description="Move APKs to unsorted state")
    parser.add_argument(
        "--unsorted_dataset",
        type=str,
        default=DEFAULT_UNSORTED_DATASET_FOLDER,
        help="The root directory of the unsorted dataset.",
    )


if __name__ == "__main__":
    args = parse_args()

    UNSORTED_DATASET_DIRECTORY = args.unsorted_dataset

    apks_path_goodware = glob.glob("Goodware*/*/*.apk", recursive=True)
    apks_path_greyware = glob.glob("Greyware*/*/*.apk", recursive=True)
    apks_path_malware = glob.glob("Malware*/*/*.apk", recursive=True)

    apks_name_goodwares = [
        (os.path.basename(apk_path)) for apk_path in apks_path_goodware
    ]
    apks_name_greywares = [
        (os.path.basename(apk_path)) for apk_path in apks_path_greyware
    ]
    apks_name_malwares = [
        (os.path.basename(apk_path)) for apk_path in apks_path_malware
    ]

    os.makedirs(UNSORTED_DATASET_DIRECTORY, exist_ok=True)

    for apk in tqdm(
        apks_path_goodware + apks_path_greyware + apks_path_malware,
        desc="Moving APKs to unsorted state...",
    ):
        shutil.move(apk, f"{UNSORTED_DATASET_DIRECTORY}/{os.path.basename(apk)}")
